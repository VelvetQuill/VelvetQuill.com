
<!DOCTYPE html>
<html>
<head>
    <meta name="robots" content="noindex, nofollow">
    <title>Health Check: Testing...</title>
    <style>
        .status { padding: 12px; margin: 8px; border-radius: 4px; }
        .good { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .bad { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .loading { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <h1>VelvetQuill Health Status</h1>
    
    <div id="checks">
        <!-- Individual test results will appear here -->
    </div>
    
    <div id="summary" style="display:none;">
        <h2 id="overall-status">Overall Status: Testing...</h2>
        <p id="timestamp">Last checked: </p>
    </div>
    
    <script>
    // Configuration - Add your critical pages here
    const tests = [
        { id: 'homepage', url: '/index.html', keyword: 'VelvetQuill', name: 'Homepage' },
        { id: 'categories', url: '/category-list.html', keyword: 'Story Categories', name: 'Category List' },
        { id: 'signin', url: '/signin.html', keyword: 'Login', name: 'Sign In Page' },
        { id: 'signup', url: '/signup.html', keyword: 'Sign Up', name: 'Sign Up Page' },
        { id: 'search', url: '/search.html', keyword: 'Search', name: 'Search Page' },
        { id: 'api-health', url: '/api/health', keyword: 'healthy', name: 'API Health', optional: true },
        // Add more as needed
    ];
    
    async function runTest(test) {
        const element = document.createElement('div');
        element.id = test.id;
        element.className = 'status loading';
        element.innerHTML = `⏳ Testing ${test.name}...`;
        document.getElementById('checks').appendChild(element);
        
        try {
            const response = await fetch(test.url, { 
                method: 'GET',
                headers: { 'Cache-Control': 'no-cache' }
            });
            const text = await response.text();
            
            if (response.ok && text.includes(test.keyword)) {
                element.className = 'status good';
                element.innerHTML = `✓ ${test.name}: Healthy (${response.status})`;
                return { success: true, test };
            } else {
                element.className = 'status bad';
                element.innerHTML = `✗ ${test.name}: Failed (Status: ${response.status})`;
                return { success: false, test, error: 'Missing keyword or bad status' };
            }
        } catch (error) {
            element.className = 'status bad';
            element.innerHTML = `✗ ${test.name}: Error - ${error.message}`;
            return { success: false, test, error: error.message };
        }
    }
    
    async function runAllTests() {
        const results = [];
        
        for (const test of tests) {
            const result = await runTest(test);
            results.push(result);
            // Small delay between tests to avoid overwhelming
            await new Promise(resolve => setTimeout(resolve, 500));
        }
        
        // Calculate overall status
        const successfulTests = results.filter(r => r.success).length;
        const totalTests = results.length;
        const allOptionalSucceeded = results.filter(r => !r.test.optional).every(r => r.success);
        
        // Update summary
        const summary = document.getElementById('summary');
        const overallStatus = document.getElementById('overall-status');
        const timestamp = document.getElementById('timestamp');
        
        if (allOptionalSucceeded) {
            overallStatus.textContent = `Overall Status: ✅ ALL SYSTEMS GO (${successfulTests}/${totalTests} tests passed)`;
            overallStatus.style.color = 'green';
            
            // IMPORTANT: This text is what UptimeRobot looks for
            document.title = 'All Systems Go';
            
            // Add hidden success marker for keyword monitoring
            const successMarker = document.createElement('div');
            successMarker.style.display = 'none';
            successMarker.id = 'success-marker';
            successMarker.textContent = 'All Systems Go - All critical systems operational';
            document.body.appendChild(successMarker);
        } else {
            overallStatus.textContent = `Overall Status: ⚠️ ISSUES DETECTED (${successfulTests}/${totalTests} tests passed)`;
            overallStatus.style.color = 'orange';
            document.title = 'Health Check: Issues Detected';
        }
        
        timestamp.textContent = `Last checked: ${new Date().toLocaleString()}`;
        summary.style.display = 'block';
        
        // Log results to console for debugging
        console.log('Health Check Results:', results);
    }
    
    // Run tests when page loads
    document.addEventListener('DOMContentLoaded', runAllTests);
    </script>
</body>
</html>

